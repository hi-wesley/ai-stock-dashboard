<!-- Search box -->
<div class="search">
    <input placeholder="Enter ticker (e.g. TSLA)" [formControl]="search" />
    <button (click)="addSymbol()">Add</button>
</div>

<!-- Scrollable list of charts -->
<cdk-virtual-scroll-viewport itemSize="500" class="viewport" style="height: calc(100vh - 80px); display: block;">

    <div *cdkVirtualFor="let sym of symbols">
        <h2>
            {{ sym }} price
            <button class="remove" (click)="removeSymbol(sym)">✖</button>
        </h2>

        <ng-container *ngIf="(priceSeries.get(sym) | async) as pts">
            <app-line-chart *ngIf="pts.length > 1; else noData" [symbol]="sym" [data]="pts">
            </app-line-chart>
        </ng-container>

        <ng-template #noData>
            <p style="color: gray; margin: 2rem 0">
                Not enough data for this symbol.
            </p>
        </ng-template>

        <div class="chat">
            <input placeholder="Ask about {{ sym }}…" [formControl]="question" />
            <button (click)="ask(sym)">Ask AI</button>
            <p class="answer" *ngIf="answer$ | async as ans">{{ ans }}</p>
        </div>

        <hr />
    </div>
</cdk-virtual-scroll-viewport>