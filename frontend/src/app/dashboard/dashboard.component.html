<div class="dashboard-container">
  <!-- search bar -->
  <div class="search glass">
    <!-- ✨ placeholder now uses GOOGL -->
    <input placeholder="Enter ticker (e.g. GOOGL)" [formControl]="search" />
    <button (click)="addSymbol()">Add</button>
  </div>

  <cdk-virtual-scroll-viewport itemSize="660" class="viewport" style="height: calc(100vh - 200px); display: block; width: 100%;">

    <div *cdkVirtualFor="let sym of symbols" class="chart-section">
      <div class="glass" style="width: 100%; max-width: 800px; margin: 1rem auto; position: relative;">
        <button class="remove" style="position: absolute; top: 1rem; right: 1rem;" (click)="removeSymbol(sym)">✖</button>
        <h2 class="row-header split-text">
          <span *ngFor="let char of sym.split(''); let i = index" 
                class="split-char" 
                [style.animation-delay.ms]="i * 50">{{ char }}</span>
        </h2>

        <!-- range toggle bar -->
        <div class="range-bar">
          @for (r of ranges; track r) {
            <button [class.active]="rangeMap.get(sym) === r" (click)="setRange(sym, r)">
              {{ rangeLabels[r] }}
            </button>
          }
        </div>

        <!-- chart -->
        @if ((priceSeries.get(sym) | async); as pts) {
          @if (pts.length > 1) {
            <app-line-chart [symbol]="sym" [data]="pts">
            </app-line-chart>
          } @else {
            <p style="color: #666; margin: 2rem 0; text-align: center;">
              Not enough data for this symbol / range.
            </p>
          }
        }

        <!-- chat -->
        <div class="chat">
          <div style="display: flex; gap: 0.5rem; justify-content: center;">
            <input placeholder="Ask about {{ sym }}…" [formControl]="questionMap.get(sym)" />
            <button (click)="ask(sym)">Ask AI</button>
          </div>

          @if ((answerMap.get(sym) | async); as ans) {
            <p class="answer">
              {{ ans }}
            </p>
          }
        </div>
      </div>
    </div>
  </cdk-virtual-scroll-viewport>
</div>